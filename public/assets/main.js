angular.module("nodercms-console",["ngAnimate","ipCookie","ui.router","ngFileUpload","angular-img-cropper","controllers","services","directives","filters","views"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,n,e,i){"use strict";i.defaults.headers.common={"content-type":"application/json;charset=utf-8"},i.interceptors.push("authorityInterceptor"),e.html5Mode(!0),n.otherwise(function(t){t.get("$state").go("main")}),t.state("signIn",{url:"^/admin/sign-in",controller:"signIn",templateProvider:["$templateCache",function(t){return t.get("sign-in.view.html")}]}).state("main",{url:"^/admin",controller:"main",templateProvider:["$templateCache",function(t){return t.get("main.view.html")}]}).state("main.sites",{url:"^/admin/sites",controller:"sites",templateProvider:["$templateCache",function(t){return t.get("sites.view.html")}]}).state("main.setting",{url:"^/admin/setting",controller:"setting",templateProvider:["$templateCache",function(t){return t.get("setting.view.html")}]})}]).run(["checkSignIn","$templateCache",function(t){t()}]),angular.module("controllers",[]),angular.module("services",[]),angular.module("directives",[]),angular.module("filters",[]),angular.module("views",[]),angular.module("controllers").controller("main",["$scope","$http",function(t,n){"use strict";t.website={hostname:window.location.hostname,origin:window.location.origin},t.systemInfo={},t.nodeInfo={},t.databaseInfo={},t.sitesTotal="",n.get("/api/dashboard").then(function(n){var e=n.data;t.systemInfo=e.systemInfo,t.nodeInfo=e.nodeInfo,t.databaseInfo=e.databaseInfo,t.sitesTotal=e.sitesTotal},function(){t.$emit("notification",{type:"danger",message:"读取控制面板数据失败"})})}]),angular.module("controllers").controller("setting",["$scope","$http",function(t,n){"use strict";t.transmitting=!0,t.version="",n.get("/api/info").success(function(n){t.version=n.version,t.transmitting=!1}).error(function(){t.$emit("notification",{type:"danger",message:"获取 NoderCMS 信息失败"})}),t.submitSetting=function(){t.transmitting=!0,n.put("/api/info",{version:t.version}).then(function(){t.transmitting=!1,t.$emit("notification",{type:"success",message:"系统信息已保存"})},function(){t.transmitting=!1,t.$emit("notification",{type:"danger",message:"系统信息保存失败"})})}}]),angular.module("controllers").controller("signIn",["$scope","$timeout","$state","$http",function(t,n,e,i){"use strict";function a(){t.wrongEmailOrPassword=!1}function s(){t.wrongCaptcha=!1}t.transmitting=!1,t.password="",t.captcha="",t.captchaData="",t.autoSignIn=!1,t.wrongEmailOrPassword=!1,t.wrongCaptcha=!1,t.$watch("password",a),t.$watch("captcha",s),t.getCaptcha=function(){i.get("/api/account/captcha").then(function(n){t.captchaData=n.data})},t.getCaptcha(),t.signIn=function(){t.transmitting=!0,i.put("/api/account/sign-in",{password:t.password,captcha:t.captcha.toLowerCase(),autoSignIn:t.autoSignIn}).then(function(){e.go("main")},function(e){t.getCaptcha();var i=e.data;switch(_.get(i,"error.code")){case"WRONG_EMAIL_OR_PASSWORD":t.wrongEmailOrPassword=!0;break;case"WRONG_CAPTCHA":t.wrongCaptcha=!0}t.animateShake=!0,n(function(){t.animateShake=!1,t.transmitting=!1},600)})}}]),angular.module("controllers").controller("sites",["$scope","$state","$stateParams","$http",function(t,n,e,i){"use strict";t.transmitting=!1,t.sites=[],t.currentPage=1,t.totalPages=0,i.get("/api/sites",{params:{currentPage:t.currentPage,pageSize:20}}).then(function(n){var e=n.data;t.sites=e.sites,t.totalPages=e.pages})}]),angular.module("services").factory("authorityInterceptor",["$q","$injector",function(t,n){"use strict";return{responseError:function(e){return 401===e.status&&e.data&&e.data.error&&n.get("$state").go("signIn"),t.reject(e)}}}]),angular.module("services").factory("checkSignIn",["$rootScope","$state","ipCookie",function(t,n,e){"use strict";return function(){t.$on("$stateChangeStart",function(t,i,a,s,o){e("nodercmsConsoleSid")||"signIn"===i.name||(t.preventDefault(),n.go("signIn"))})}}]),angular.module("directives").directive("ndNavigation",["$templateCache","$rootScope","$state","$timeout","$http","$filter",function(t,n,e,i,a,s){return{restrict:"E",template:t.get("navigation.view.html"),link:function(t,s){function o(){i(function(){$(".sub-list").each(function(){var t=$(this);t.children(".item").hasClass("active")?t.siblings(".item").addClass("active select"):t.slideUp("fast",function(){t.siblings(".sub-list-heading").removeClass("select")}).siblings(".sub-list-heading").removeClass("active")})})}t.notFoundPages=!1,t.notFoundContents=!1,t.auth={},t.categories=[],t.user={},t.signOut=function(){a.put("/api/account/sign-out").then(function(){e.go("signIn")},function(){t.$emit("notification",{type:"danger",message:"退出登录失败"})})},n.$on("$stateChangeSuccess",function(){i(function(){o()})}),n.$on("mainCategoriesUpdate",function(){loadCategories()}),n.$on("mainUserUpdate",function(){account.reset(),loadUser()}),$(".navigation").on("click",".sub-list-heading",function(){var t=$(this);t.hasClass("select")?t.siblings(".sub-list").slideUp("fast",function(){$(this).siblings(".sub-list-heading").removeClass("select")}):t.siblings(".sub-list").slideDown("fast",function(){$(this).siblings(".sub-list-heading").addClass("select")}),$(".sub-list:visible").not(t.siblings(".sub-list")).slideUp("fast",function(){$(this).siblings(".sub-list-heading").removeClass("select")})})}}}]),angular.module("directives").directive("ndNotification",["$timeout","$rootScope",function(t,n){return{replace:!0,link:function(e){function i(){a=!0,t(function(){s-- >0?i():(a=!1,e.notificationShow=!1)},1e3)}var a,s;n.$on("notification",function(t,n){s=3,e.type=n.type,e.message=n.message,e.notificationShow=!0,a||i()})}}}]);